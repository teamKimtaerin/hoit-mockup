{
  "id": "caption-with-intention",
  "name": "Caption with Intention",
  "description": "Dynamic captions that emphasize important words based on volume, pitch, and emotional content",
  "version": "1.0.0",
  "author": "ECG Template System",
  "category": "emphasis",

  "style": {
    "text": {
      "fontFamily": "Pretendard, Inter, sans-serif",
      "fontSize": "4.8vh",
      "fontWeight": 600,
      "color": "#ffffff",
      "textAlign": "center",
      "textShadow": "2px 2px 4px rgba(0,0,0,0.8)",
      "letterSpacing": "0.02em",
      "lineHeight": 1.2
    },
    "background": {
      "type": "box",
      "color": "#000000",
      "opacity": 0.85,
      "borderRadius": 12,
      "padding": "12px 20px",
      "borderWidth": 1,
      "borderColor": "#333333"
    }
  },

  "layout": {
    "track": {
      "position": "bottom",
      "safeArea": {
        "top": "85%",
        "bottom": "8%",
        "left": "8%",
        "right": "8%"
      },
      "maxWidth": "84%",
      "alignment": "center"
    },
    "words": {
      "spacing": "0.3em",
      "lineBreaking": "auto",
      "maxWordsPerLine": 8
    }
  },

  "variables": {
    "loud_threshold": {
      "name": "Loud Speech Threshold",
      "description": "Threshold for detecting loud/emphasized speech",
      "expression": "{{volume_statistics.baseline_db}} + ({{volume_statistics.global_max_db}} - {{volume_statistics.baseline_db}}) * 0.6",
      "cached": true
    },
    "very_loud_threshold": {
      "name": "Very Loud Speech Threshold",
      "description": "Threshold for detecting very loud/excited speech",
      "expression": "{{volume_statistics.baseline_db}} + ({{volume_statistics.global_max_db}} - {{volume_statistics.baseline_db}}) * 0.85",
      "cached": true
    },
    "high_pitch_threshold": {
      "name": "High Pitch Threshold",
      "description": "Threshold for detecting high pitch speech",
      "expression": "{{pitch_statistics.baseline_range.max_hz}} + ({{pitch_statistics.global_max_hz}} - {{pitch_statistics.baseline_range.max_hz}}) * 0.5",
      "cached": true
    }
  },

  "animationRules": [
    {
      "id": "loud-word-bounce",
      "name": "Loud Word Bounce",
      "description": "Bouncing animation for loud words",
      "condition": {
        "field": "volume_db",
        "operator": "gt",
        "value": "{{loud_threshold}}"
      },
      "animation": {
        "pluginName": "cwi-bouncing",
        "params": {
          "amplitude": [0.1, 0.25],
          "frequency": [2.0, 3.5],
          "damping": 0.8,
          "direction": "vertical"
        },
        "timing": {
          "offset": ["-0.05s", "+0.15s"],
          "easing": "easeOutBounce"
        },
        "intensity": {
          "min": 0.5,
          "max": 1.0,
          "mapping": "exponential"
        }
      },
      "priority": 8,
      "exclusive": false
    },

    {
      "id": "very-loud-scale",
      "name": "Very Loud Scaling",
      "description": "Scaling effect for very loud words",
      "condition": {
        "field": "volume_db",
        "operator": "gt",
        "value": "{{very_loud_threshold}}"
      },
      "animation": {
        "pluginName": "elastic",
        "params": {
          "scale": [1.1, 1.3],
          "elasticity": 0.3,
          "duration": 0.5
        },
        "timing": {
          "offset": ["0s", "+0.25s"],
          "easing": "easeOutElastic"
        },
        "intensity": {
          "min": 0.6,
          "max": 0.9,
          "mapping": "linear"
        }
      },
      "priority": 9,
      "exclusive": false
    },

    {
      "id": "high-pitch-rotation",
      "name": "High Pitch Rotation",
      "description": "Rotation for high-pitched words",
      "condition": {
        "field": "pitch_hz",
        "operator": "gt",
        "value": "{{high_pitch_threshold}}"
      },
      "animation": {
        "pluginName": "rotation",
        "params": {
          "angle": [2, 6],
          "axis": "z",
          "oscillate": true,
          "cycles": 1
        },
        "timing": {
          "offset": ["0s", "+0.1s"],
          "easing": "easeInOutSine"
        },
        "intensity": {
          "min": 0.4,
          "max": 0.8,
          "mapping": "linear"
        }
      },
      "priority": 6,
      "exclusive": false
    },

    {
      "id": "emotional-glow",
      "name": "Emotional Glow",
      "description": "Glow effect for emotional words",
      "condition": {
        "field": "segment.emotion.confidence",
        "operator": "gt",
        "value": 0.7,
        "and": [
          {
            "field": "segment.emotion.emotion",
            "operator": "in",
            "value": ["joy", "anger", "surprise"]
          }
        ]
      },
      "animation": {
        "pluginName": "glow",
        "params": {
          "color": "#FFD700",
          "intensity": [0.2, 0.6],
          "blur": [1, 3],
          "spread": 0.8
        },
        "timing": {
          "offset": ["-0.1s", "+0.3s"],
          "easing": "easeInOutQuad"
        },
        "intensity": {
          "min": 0.3,
          "max": 0.7,
          "mapping": "linear"
        }
      },
      "priority": 7,
      "exclusive": false
    },

    {
      "id": "question-pulse",
      "name": "Question Pulse",
      "description": "Pulse effect for questions",
      "condition": {
        "field": "word",
        "operator": "contains",
        "value": "?",
        "or": [
          {
            "field": "segment.text",
            "operator": "contains",
            "value": "?"
          }
        ]
      },
      "animation": {
        "pluginName": "pulse",
        "params": {
          "scale": [1.0, 1.15],
          "pulses": 2,
          "duration": 0.8
        },
        "timing": {
          "offset": ["0s", "+0.4s"],
          "easing": "easeInOutQuad"
        },
        "intensity": {
          "min": 0.5,
          "max": 0.8,
          "mapping": "linear"
        }
      },
      "priority": 8,
      "exclusive": false
    }
  ],

  "metadata": {
    "tags": ["emphasis", "dynamic", "audio-driven", "emotional"],
    "useCase": ["podcast", "interview", "presentation", "vlog"],
    "audioFeatures": ["volume_db", "pitch_hz", "emotion", "confidence"],
    "complexity": "moderate",
    "performance": {
      "estimatedRenderTime": "medium",
      "memoryUsage": "medium"
    },
    "compatibility": {
      "minRendererVersion": "2.0.0",
      "supportedAspectRatios": ["16:9", "9:16", "1:1"]
    }
  }
}
